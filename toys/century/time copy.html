<script>
    class VisGrid { 
        constructor(el) { 
            this.el = el; 
            this.elGridButtons = [] 
        }

        replaceGrid(gv) { 
            const grid = document.createElement("div"); 
            grid.classList.add("grid-container"); 

            const labels = document.createElement("div"); 
            labels.classList.add("labels-column");  
            

            for (let i = 0; i < gv.height; ++i) { 
                const lbl = document.createElement("div"); 
                lbl.innerText = gv.getRowText(i); 
                lbl.classList.add("decade-label", "text-small", "text-align-center", "text-sans-serif"); 
                labels.appendChild(lbl); 

                
                for (let j = 0; j < gv.width; ++j) { 
                    const cell = document.createElement("div"); 
                    cell.classList.add(gv.getCellClass(j, i), "text-sans-serif", "text-small"); 
                    
                    // Calculate staggered delay based on position
                    const cellIndex = i * gv.width + j;
                    const factor = 0.30 / ( gv.width * gv.height ); 
                    const delay = cellIndex * factor; // 20ms delay between each item
                    cell.style.animationDelay = `${delay}s`;
                    cell.innerText = gv.getCellText ? gv.getCellText(j, i) : ""; 
                    
                    grid.appendChild(cell); 
                }
            }

            this.el.replaceChildren(); 
            this.el.style = `--grid-width:${gv.width}; --grid-height:${gv.height};`; 
            this.el.appendChild(labels); 
            this.el.appendChild(grid); 
            
        }    

        bindGridButton(btnId, gv, gvUpdate, isDefault) { 
            const btn = document.getElementById(btnId);
            if (!btn) {
                console.error(`Button with ID "${btnId}" not found`);
                return;
            }

            

            this.elGridButtons.push(btn); 

            const onClick = () => { 
                gvUpdate(); 
                this.replaceGrid(gv); 

                this.elGridButtons.forEach(el => {
                    el.classList.remove("active"); 
                });

                btn.classList.add("active"); 

                const pDesc = document.getElementById("p-y100-desc");
                pDesc.innerText = gv.desc; 
            };

            if (isDefault) onClick(); 
            btn.addEventListener("click", onClick); 
        }
    }
</script>


 




<h3> The Past </h3>

<x-row>
    <x-btn-group class="w-100">
        <button class="btn btn-primary" id="btn-y100-now"  > 2026 </button>
        <button class="btn btn-primary" id="btn-y100-2020" > COVID-19 <br> Lockdowns </button>
        <button class="btn btn-primary" id="btn-y100-2008" > Financial <br> Crisis 2008 </button>
        <button class="btn btn-primary" id="btn-y100-2001" > 9/11 <br> Attack </button>
        <button class="btn btn-primary" id="btn-y100-1991"> Soviet <br> Collapse </button>
        <button class="btn btn-primary" id="btn-y100-1972"> Last <br> Moonwalk </button>
    </x-btn-group>
</x-row>

<h3> Your Age </h3>

<x-row class="gap-md align-items-center">
    <x-col class="fl-row fl-wrap gap-sm ">
        <button class="btn btn-primary" id="btn-y100-18"> Childhood </button>
        <button class="btn btn-primary" id="btn-y100-40"> Middle <br> Age </button>
        <button class="btn btn-primary" id="btn-y100-80"> Average <br> Life Expectancy </button>
    </x-col>
</x-row>

<x-row class="metabox text-sans-serif">
    <p class="text-body-light" id="p-y100-desc">asdf</p>
</x-row>

<x-row class="overflow-x">
    <div id="grid-y100" class="gcontainer"> </div>
</x-row>

<script>
    const vgY100 = new VisGrid(
        document.querySelector("#grid-y100")
    );

    class GridY100 { 
        constructor() { 
            this.width = 10 
            this.height = 10 
            this.startYear = 2026
            this.endYear = 2026
            this.markYear = 2026
            this.desc = ""
        }

        setMarkYear(mark) { 

        }

        setRangeYears(start, end) { 
            
        }

        getRowText(i) { 
            return [
                "First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eight", "Ninth", "Tenth"
            ][i] + " Decade"; 
        }

        getCellText(i, j) { 
            
            const yearDist = this.endYear - this.startYear; 
            const year = this.getYearFromCell(i, j); 
            const yearString = `${year}`;
            return yearString;  
        }

        getCellClass(i, j) { 
            const year = this.getYearFromCell(i, j); 
            if (year < this.startYear || year > this.endYear)
                return "grid-item-off";  
            return "grid-item-mark";  
        }

        getYearFromCell(i, j) { 
            const idx = j * this.width + i; 
            const year = this.startYear + idx; 
            return year; 
        }
    }

    const gvY100 = new GridY100(); 



    vgY100.bindGridButton("btn-y100-2020", gvY100, () => {
        gvY100.desc = "Since the first COVID-19 lockdown in Italy. March 9, 2020."
        gvY100.startYear = 2020;  
        gvY100.endYear = ( new Date().getFullYear() ); 
    }, true); 

    vgY100.bindGridButton("btn-y100-2008", gvY100, () => {
        gvY100.desc = "Since the collapse of Lehman Brothers. Sepember 15, 2008."
        gvY100.startYear = 2008;  
        gvY100.endYear = ( new Date().getFullYear() ); 
    }); 

    vgY100.bindGridButton("btn-y100-2001", gvY100, () => {
        gvY100.desc = "Since the largest terror attack in United States history. September 11, 2021."
        gvY100.startYear = 2001;  
        gvY100.endYear = ( new Date().getFullYear() ); 
    }); 

    vgY100.bindGridButton("btn-y100-1991", gvY100, () => {
        gvY100.desc = "Since the fall of the Soviet Union. December 26, 1991.";
        gvY100.startYear = 1991;  
        gvY100.endYear = ( new Date().getFullYear() ); 
    }); 

    vgY100.bindGridButton("btn-y100-1972", gvY100, () => {
        gvY100.desc = "Since the final moon walk, from the Apollo 17 mission. December 14, 1972."
        gvY100.startYear = 1972;  
        gvY100.endYear = ( new Date().getFullYear() ); 
    });
    
    vgY100.bindGridButton("btn-y100-18", gvY100, () => {
        gvY100.desc = "From birth to adulthood."
        gvY100.endYear = ( new Date().getFullYear() );
        gvY100.startYear = gvY100.endYear - 18;  
        
    }); 

    vgY100.bindGridButton("btn-y100-40", gvY100, () => {
        gvY100.desc = "From birth to middle-age."
        gvY100.endYear = ( new Date().getFullYear() );
        gvY100.startYear = gvY100.endYear - 40;  
    }); 

    vgY100.bindGridButton("btn-y100-80", gvY100, () => {
        gvY100.desc = "The average life expetancy of a Canadian man."
        gvY100.endYear = ( new Date().getFullYear() );
        gvY100.startYear = gvY100.endYear - 80;  
    }); 


</script>

<style>
    .gcontainer {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: var(--space-md);
        align-items: start;

        --grid-width: 10; 
        --grid-height: 10; 

        width: 100%;
        overflow-x: auto;
    }
    
    .labels-column {
        --grid-width: 10; 
        --grid-height: 10; 

        display: grid;
        grid-template-rows: repeat(var(--sz), 1fr);
        gap: var(--space-sm);
        height: 100%;
    }
    
    .decade-label {
        display: flex;
        align-items: center;
        white-space: nowrap;
    }
    
    .grid-container {
        display: grid;
        grid-template-columns: repeat(var(--grid-width), 1fr);
        grid-template-rows: repeat(var(--grid-height), 1fr);
        gap: var(--space-sm);
        
        
        
    }

    @keyframes scaleIn {
        from {
            transform: scale(0);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    .grid-item-on {

        min-width: fit-content;
        padding: var(--space-xs); 

        background-color: var(--color-primary-dark);
        aspect-ratio: 1 / 1;
        border: var(--border-md) dashed var(--color-primary); 
        border-radius: var(--border-radius);
        
        /* Animation properties */
        animation: scaleIn var(--transition-speed) ease-out forwards;
        transform: scale(0);
        opacity: 0;

        overflow: hidden;
        height: 100%;       
        
        /* Flexbox centering */
        display: flex;
        justify-content: center;  /* horizontal center */
        align-items: center;      /* vertical center */
    }

    .grid-item-off {
        min-width: fit-content;
        padding: var(--space-xs); 

        aspect-ratio: 1 / 1;
        height: 100%;
        border: var(--border-md) dashed var(--color-primary-dark); 
        border-radius: var(--border-radius);
        
        /* Animation properties */
        animation: scaleIn var(--transition-speed) ease-out forwards;
        transform: scale(0);
        opacity: 0;

        overflow: hidden;

        color: var(--color-gray); 

        /* Flexbox centering */
        display: flex;
        justify-content: center;  /* horizontal center */
        align-items: center;      /* vertical center */
    }

    .grid-item-mark {
        min-width: fit-content;
        padding: var(--space-xs); 

        aspect-ratio: 1 / 1;
        height: 100%;
        border: var(--border-md) solid var(--color-primary); 
        border-radius: var(--border-radius);
        
        /* Animation properties */
        animation: scaleIn var(--transition-speed) ease-out forwards;
        transform: scale(0);
        opacity: 0;

        overflow: hidden;

        color: var(--color-darker); 
        background-color: var(--color-primary);

        /* Flexbox centering */
        display: flex;
        justify-content: center;  /* horizontal center */
        align-items: center;      /* vertical center */
    }
</style>