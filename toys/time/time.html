<script>
    class VisGrid { 
        constructor(el) { 
            this.el = el; 
            this.elGridButtons = [] 
        }

        replaceGrid(gv) { 
            const grid = document.createElement("div"); 
            grid.classList.add("grid-container"); 

            const labels = document.createElement("div"); 
            labels.classList.add("labels-column");  
            

            for (let i = 0; i < gv.height; ++i) { 
                const lbl = document.createElement("div"); 
                lbl.innerText = gv.getRowText(i); 
                lbl.classList.add("decade-label", "text-small", "text-align-center", "text-sans-serif"); 
                labels.appendChild(lbl); 

                
                for (let j = 0; j < gv.width; ++j) { 
                    const cell = document.createElement("div"); 
                    cell.classList.add(gv.getCellClass(j, i), "text-sans-serif", "text-small"); 
                    
                    // Calculate staggered delay based on position
                    const cellIndex = i * gv.width + j;
                    const factor = 0.30 / ( gv.width * gv.height ); 
                    const delay = cellIndex * factor; // 20ms delay between each item
                    cell.style.animationDelay = `${delay}s`;
                    cell.innerText = gv.getCellText ? gv.getCellText(j, i) : ""; 
                    
                    grid.appendChild(cell); 
                }
            }

            this.el.replaceChildren(); 
            this.el.style = `--grid-width:${gv.width}; --grid-height:${gv.height};`; 
            this.el.appendChild(labels); 
            this.el.appendChild(grid); 
            
        }    

        bindGridButton(btnId, gv, gvUpdate, isDefault) { 
            const btn = document.getElementById(btnId);
            if (!btn) {
                console.error(`Button with ID "${btnId}" not found`);
                return;
            }

            

            this.elGridButtons.push(btn); 

            const onClick = () => { 
                gvUpdate(); 
                this.replaceGrid(gv); 

                this.elGridButtons.forEach(el => {
                    el.classList.remove("active"); 
                });

                btn.classList.add("active"); 

                const pDesc = document.getElementById("p-y100-desc");
                pDesc.innerText = gv.desc; 
            };

            if (isDefault) onClick(); 
            btn.addEventListener("click", onClick); 
        }
    }
</script>

<hr>

<x-row class="gap-md align-items-center">
    <x-col class="fl-row fl-wrap gap-sm ">
        <button id="btn-y100-2020" > COVID-19 <br> Lockdowns </button>
        <button id="btn-y100-2008" > Financial <br> Crisis 2008 </button>
        <button id="btn-y100-2001" > 9/11 <br> Attack </button>
        <button id="btn-y100-1991"> Soviet <br> Collapse </button>
        <button id="btn-y100-1972"> Last <br> Moonwalk </button>

        <button id="btn-y100-18"> Childhood </button>
        <button id="btn-y100-40"> Middle <br> Age </button>
        <button id="btn-y100-80"> Average <br> Life Expectancy </button>
    </x-col>
</x-row>

<x-row class="metabox text-sans-serif">
    <p class="text-body-light" id="p-y100-desc">asdf</p>
</x-row>

<x-row class="overflow-x">
    <div id="grid-y100" class="gcontainer"> </div>
</x-row>

<script>
    const vgY100 = new VisGrid(
        document.querySelector("#grid-y100")
    );

    const gvY100 = {
        width: 10, 
        height: 10, 
        years: 32,
        startYear: 0,
        desc: "", 
        getRowText: (i) => { 
            return [
                "First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eight", "Ninth", "Tenth"
            ][i] + " Decade"; 
        },

        getCellClass: (i, j) => { 
            return ( j*gvY100.width+i ) < gvY100.years+1 ? "grid-item-on" : "grid-item-off"; 
        },

        getCellText: (i, j) => { 
            const nowYear = new Date().getFullYear(); 
            const yearDist = gvY100.years + 1
            const yearOffset = ( j*gvY100.width+i ); 
            const yearString = `${nowYear-yearDist+yearOffset+1}`;
            return yearString;  
        }
    };  



    vgY100.bindGridButton("btn-y100-2020", gvY100, () => {
        gvY100.desc = "Since the first COVID-19 lockdown in Italy. March 9, 2020."
        gvY100.years = ( new Date().getFullYear() ) - 2020;
    }, true); 

    vgY100.bindGridButton("btn-y100-2008", gvY100, () => {
        gvY100.desc = "Since the collapse of Lehman Brothers. Sepember 15, 2008."
        gvY100.years = ( new Date().getFullYear() ) - 2008;
    }); 

    vgY100.bindGridButton("btn-y100-2001", gvY100, () => {
        gvY100.desc = "Since the largest terror attack in United States history. September 11, 2021."
        gvY100.years = ( new Date().getFullYear() ) - 2001;
    }); 

    vgY100.bindGridButton("btn-y100-1991", gvY100, () => {
        gvY100.desc = "Since the fall of the Soviet Union. December 26, 1991.";
        gvY100.years = ( new Date().getFullYear() ) - 1991;
    }); 

    vgY100.bindGridButton("btn-y100-1972", gvY100, () => {
        gvY100.desc = "Since the final moon walk, from the Apollo 17 mission. December 14, 1972."
        gvY100.years = ( new Date().getFullYear() ) - 1972; 
    });
    
    vgY100.bindGridButton("btn-y100-18", gvY100, () => {
        gvY100.desc = "From birth to adulthood."
        gvY100.years = 18; 
    }); 

    vgY100.bindGridButton("btn-y100-40", gvY100, () => {
        gvY100.desc = "From birth to middle-age."
        gvY100.years = 40; 
    }); 

    vgY100.bindGridButton("btn-y100-80", gvY100, () => {
        gvY100.desc = "The average life expetancy of a Canadian man."
        gvY100.years = 80; 
    }); 


</script>

<style>
    .gcontainer {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: var(--space-md);
        align-items: start;

        --grid-width: 10; 
        --grid-height: 10; 

        width: 100%;
        overflow-x: auto;
    }
    
    .labels-column {
        --grid-width: 10; 
        --grid-height: 10; 

        display: grid;
        grid-template-rows: repeat(var(--sz), 1fr);
        gap: var(--space-sm);
        height: 100%;
    }
    
    .decade-label {
        display: flex;
        align-items: center;
        white-space: nowrap;
    }
    
    .grid-container {
        display: grid;
        grid-template-columns: repeat(var(--grid-width), 1fr);
        grid-template-rows: repeat(var(--grid-height), 1fr);
        gap: var(--space-sm);
        
        
        
    }

    @keyframes scaleIn {
        from {
            transform: scale(0);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    .grid-item-on {

        min-width: fit-content;
        padding: var(--space-xs); 

        background-color: var(--color-primary-dark);
        aspect-ratio: 1 / 1;
        border: var(--border-md) dashed var(--color-primary); 
        border-radius: var(--border-radius);
        
        /* Animation properties */
        animation: scaleIn var(--transition-speed) ease-out forwards;
        transform: scale(0);
        opacity: 0;

        overflow: hidden;
        height: 100%;       
        
        /* Flexbox centering */
        display: flex;
        justify-content: center;  /* horizontal center */
        align-items: center;      /* vertical center */
    }

    .grid-item-off {
        min-width: fit-content;
        padding: var(--space-xs); 

        aspect-ratio: 1 / 1;
        height: 100%;
        border: var(--border-md) dashed var(--color-primary-dark); 
        border-radius: var(--border-radius);
        
        /* Animation properties */
        animation: scaleIn var(--transition-speed) ease-out forwards;
        transform: scale(0);
        opacity: 0;

        overflow: hidden;

        color: var(--color-gray); 

        /* Flexbox centering */
        display: flex;
        justify-content: center;  /* horizontal center */
        align-items: center;      /* vertical center */
    }
</style>